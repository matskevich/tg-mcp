# ๐จ ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต ะฐััะธัะตะบัััั ะดะปั ััะตะผั

## ะงัะพ ััะพ ะทะฐ ัะธััะตะผะฐ?

ะกะธััะตะผะฐ ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ะดะพัััะฟะฐ ะบ Telegram API ั ะทะฐัะธัะพะน ะพั ะฑะปะพะบะธัะพะฒะพะบ.

---

## 5 ะพัะฝะพะฒะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ

### 1. ๐ Session Management
**ะงัะพ:** ะคะฐะนะป ั ัะพะบะตะฝะฐะผะธ ะฐะฒัะพัะธะทะฐัะธะธ  
**ะะดะต:** `data/sessions/s16_session.session`  
**ะะฐัะตะผ:** ะงัะพะฑั ะฝะต ะฒะฒะพะดะธัั ะบะพะด ะบะฐะถะดัะน ัะฐะท  
**ะะฐะบ ะฒัะณะปัะดะธั:** ะคะฐะนะป ั ะทะฐะผะบะพะผ ๐, ะฟัะฐะฒะฐ ะดะพัััะฟะฐ 600

### 2. ๐ชฃ Token Bucket (Rate Limiter)
**ะงัะพ:** ะะตะดัะพ ั ัะพะบะตะฝะฐะผะธ ะดะปั ะพะณัะฐะฝะธัะตะฝะธั ัะบะพัะพััะธ  
**ะะดะต:** ะ ะฟะฐะผััะธ, ัะฟัะฐะฒะปัะตััั `limiter.py`  
**ะะฐัะตะผ:** ะงัะพะฑั ะฝะต ะฟัะตะฒััะธัั ะปะธะผะธั Telegram (4 ะทะฐะฟัะพัะฐ/ัะตะบ)  
**ะะฐะบ ะฒัะณะปัะดะธั:** ะะตะดัะพ ั ัะฐัะธะบะฐะผะธ/ะฑะปะพะบะฐะผะธ, ะฟะพะบะฐะทัะฒะฐะตั ัะบะพะปัะบะพ ัะพะบะตะฝะพะฒ ะพััะฐะปะพัั (ะฝะฐะฟัะธะผะตั, 8/10)

### 3. ๐ก๏ธ Safe Call Wrapper
**ะงัะพ:** ะะฑะตััะบะฐ ะฒะพะบััะณ ะฒัะตั API ะฒัะทะพะฒะพะฒ  
**ะะดะต:** `limiter.py` โ ััะฝะบัะธั `safe_call()`  
**ะะฐัะตะผ:** ะะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐัะธัะฐ ะฒัะตั ะทะฐะฟัะพัะพะฒ  
**ะะฐะบ ะฒัะณะปัะดะธั:** ะฉะธั/ะบะพะฝัะตะนะฝะตั ะฒะพะบััะณ ััะฝะบัะธะธ, ะฒะฝัััะธ ััะฐะฟั: ะฟัะพะฒะตัะบะฐ โ ัะพะบะตะฝ โ ะฒัะฟะพะปะฝะตะฝะธะต โ retry

### 4. ๐ ะะฒะพัั (Daily Limits)
**ะงัะพ:** ะกัะตััะธะบะธ ะพะฟะตัะฐัะธะน ะฒ ะดะตะฝั  
**ะะดะต:** ะคะฐะนะป `data/anti_spam/daily_counters.txt`  
**ะะฐัะตะผ:** ะะฐัะธัะฐ ะพั ะฟัะตะฒััะตะฝะธั ะปะธะผะธัะพะฒ (20 DM/ะดะตะฝั, 20 Join/ะดะตะฝั)  
**ะะฐะบ ะฒัะณะปัะดะธั:** ะัะพะณัะตัั-ะฑะฐัั, ัะฐะนะป ั ะดะฐะฝะฝัะผะธ, ัะฐัั ะดะปั ัะฑัะพัะฐ ะฒ 00:00 UTC

### 5. ๐ฅ GroupManager (High-Level API)
**ะงัะพ:** ะฃะดะพะฑะฝัะน ะธะฝัะตััะตะนั ะดะปั ัะฐะทัะฐะฑะพััะธะบะฐ  
**ะะดะต:** `groups.py`  
**ะะฐัะตะผ:** ะกะบััะฒะฐะตั ะดะตัะฐะปะธ, ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธะผะตะฝัะตั ะทะฐัะธัั  
**ะะฐะบ ะฒัะณะปัะดะธั:** ะะปะพะบ ั ะผะตัะพะดะฐะผะธ (get_group_info, get_participants ะธ ั.ะด.)

---

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั ะฒะผะตััะต?

```
ะะฐะทัะฐะฑะพััะธะบ ะฟะธัะตั ะบะพะด
    โ
GroupManager (ัะดะพะฑะฝัะน API)
    โ
Safe Call (ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐัะธัะฐ)
    โ
    โโโ ะัะพะฒะตัะบะฐ ะบะฒะพั (DM/Join ะปะธะผะธัั)
    โโโ ะะพะปััะตะฝะธะต ัะพะบะตะฝะฐ ะธะท ะฒะตะดัะฐ
    โโโ ะัะฟะพะปะฝะตะฝะธะต ะทะฐะฟัะพัะฐ
        โ
    Telegram Client + Session (ะฐะฒัะพัะธะทะฐัะธั)
        โ
    Telegram API (ัะตัะฒะตัั)
```

---

## ะะธะทัะฐะปัะฝัะต ัะปะตะผะตะฝัั

### ะฆะฒะตัะฐ:
- ๐ต ะกะธะฝะธะน - Session (ะฑะตะทะพะฟะฐัะฝะพััั)
- ๐ข ะะตะปะตะฝัะน - Rate Limiter (ะบะพะฝััะพะปั)
- ๐ก ะะตะปััะน - Safe Call (ะทะฐัะธัะฐ)
- ๐ฃ ะคะธะพะปะตัะพะฒัะน - GroupManager (ัะดะพะฑััะฒะพ)
- ๐ด ะัะฐัะฝัะน - Telegram API (ะฒะฝะตัะฝะธะน ัะตัะฒะธั)

### ะะบะพะฝะบะธ:
- ๐ Session ัะฐะนะป
- ๐ชฃ Token Bucket (ะฒะตะดัะพ)
- ๐ก๏ธ Safe Call (ัะธั)
- ๐ ะะฒะพัั (ะณัะฐัะธะบ)
- ๐ฅ GroupManager (ะณััะฟะฟะฐ)

### ะกััะตะปะบะธ:
- ะขะพะปััะฐั โ ะพัะฝะพะฒะฝะพะน ะฟะพัะพะบ
- ะขะพะฝะบะฐั โ ะฟัะพะฒะตัะบะฐ/ะฒัะพัะธัะฝัะน ะฟะพัะพะบ
- ะัะฝะบัะธั โ ะพะฟัะธะพะฝะฐะปัะฝะพ
- ะัะฐัะฝะฐั โ ะพัะธะฑะบะฐ/retry

---

## ะะปััะตะฒัะต ะผะพะผะตะฝัั ะดะปั ััะตะผั

1. **Session = ะฐะฒัะพัะธะทะฐัะธั ะฑะตะท ะบะพะดะฐ**
   - ะคะฐะนะป โ ะะปะธะตะฝั (ััะตะฝะธะต ัะพะบะตะฝะพะฒ)
   - ะะปะธะตะฝั โ ะคะฐะนะป (ะทะฐะฟะธัั ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต)

2. **Token Bucket = ะฟะปะฐะฒะฝะพะต ะพะณัะฐะฝะธัะตะฝะธะต**
   - ะะตะดัะพ ั ัะพะบะตะฝะฐะผะธ (8/10)
   - ะะพะฟะพะปะฝะตะฝะธะต ัะฒะตััั (4 ัะพะบะตะฝะฐ/ัะตะบ)
   - ะะฐััะพะด ัะฝะธะทั (1 ัะพะบะตะฝ ะฝะฐ ะทะฐะฟัะพั)

3. **Safe Call = ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐัะธัะฐ**
   - ะะฑะตััะบะฐ ะฒะพะบััะณ ััะฝะบัะธะธ
   - ะะฝัััะธ: ะฟัะพะฒะตัะบะฐ โ ัะพะบะตะฝ โ ะฒัะฟะพะปะฝะตะฝะธะต โ retry

4. **ะะฒะพัั = ะทะฐัะธัะฐ ะพั ะฑะปะพะบะธัะพะฒะพะบ**
   - ะัะพะณัะตัั-ะฑะฐัั (8/20 DM, 4/20 Join)
   - ะคะฐะนะป ััะตััะธะบะพะฒ
   - ะกะฑัะพั ะฒ 00:00 UTC

5. **ะัะต ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ**
   - ะะฐะทัะฐะฑะพััะธะบ ะฝะต ะดัะผะฐะตั ะพ ะทะฐัะธัะต
   - ะัะต ะบะพะผะฟะพะฝะตะฝัั ัะฐะฑะพัะฐัั ะฒะผะตััะต

---

## ะัะพััะฐั ััะตะผะฐ (ัะตะบััะพะฒะฐั)

```
โโโโโโโโโโโโโโโ
โ ะะฐะทัะฐะฑะพััะธะบ โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ GroupManagerโ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ      โโโโโโโโโโโโ
โ Safe Call   โโโโโโโโค Quotas   โ
โ             โ      โโโโโโโโโโโโ
โ             โ
โ             โโโโโโโโ
โโโโโโโโฌโโโโโโโ      โ
       โ             โ
       โ      โโโโโโโโดโโโโโโโ
       โ      โ Token Bucketโ
       โ      โโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Client +    โ
โ Session     โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Telegram APIโ
โโโโโโโโโโโโโโโ
```

---

## ะงัะพ ะฟะพะบะฐะทะฐัั ะบััะฟะฝะพ?

1. **Token Bucket** - ัะฐะผะพะต ะฒะฐะถะฝะพะต ะดะปั ะฟะพะฝะธะผะฐะฝะธั rate limiting
2. **Safe Call** - ะฟะพะบะฐะทัะฒะฐะตั ะบะฐะบ ัะฐะฑะพัะฐะตั ะทะฐัะธัะฐ
3. **Session** - ะฟะพะบะฐะทัะฒะฐะตั ะฐะฒัะพัะธะทะฐัะธั

---

## ะงัะพ ะฟะพะบะฐะทะฐัั ะผะตะปะบะพ?

1. **Metrics** - ะผะพะถะฝะพ ะฒ ัะณะปั ะธะปะธ ะพัะดะตะปัะฝะพ
2. **ะะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ** - ะฝะต ะฝัะถะฝั ะดะปั ะพะฑัะตะน ััะตะผั

---

## ะัะพะณะพะฒะฐั ััััะบัััะฐ ััะตะผั

**ะะตัั:** ะะฐะทัะฐะฑะพััะธะบ โ GroupManager  
**ะฆะตะฝัั:** Safe Call (ะฑะพะปััะพะน ะฑะปะพะบ) ั ะฟะพะดะบะปััะตะฝะธัะผะธ ะบ Quotas ะธ Token Bucket  
**ะะธะท:** Client + Session โ Telegram API

**ะกะฑะพะบั:** Metrics (ะพะฟัะธะพะฝะฐะปัะฝะพ)

---

## ะขะตะบัั ะดะปั ััะตะผั

**ะะฐะณะพะปะพะฒะพะบ:** "ะััะธัะตะบัััะฐ: Session + Anti-Spam ัะธััะตะผะฐ"

**ะะพะดะฟะธัะธ:**
- "Session ัะฐะนะป ััะฐะฝะธั ัะพะบะตะฝั ะฐะฒัะพัะธะทะฐัะธะธ"
- "Token Bucket ะพะณัะฐะฝะธัะธะฒะฐะตั ัะบะพัะพััั (4 ะทะฐะฟัะพัะฐ/ัะตะบ)"
- "Safe Call ะทะฐัะธัะฐะตั ะฒัะต API ะฒัะทะพะฒั ะฐะฒัะพะผะฐัะธัะตัะบะธ"
- "ะะฒะพัั ะทะฐัะธัะฐัั ะพั ะฟัะตะฒััะตะฝะธั ะปะธะผะธัะพะฒ Telegram"
- "GroupManager ัะบััะฒะฐะตั ะดะตัะฐะปะธ ะพั ัะฐะทัะฐะฑะพััะธะบะฐ"

