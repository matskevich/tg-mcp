# üõ°Ô∏è –°—Ç—Ä–∞—Ç–µ–≥–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

## –¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

–°–∏—Å—Ç–µ–º–∞ —É–∂–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç –ª–∏–º–∏—Ç–æ–≤:

1. **Rate Limiting**: 4 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫ (Token Bucket)
2. **Smart Pause**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ –∫–∞–∂–¥—ã–µ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π
3. **FLOOD_WAIT retry**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å exponential backoff
4. **Safe Call**: –≤—Å–µ API –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `safe_call` wrapper

## üöÄ –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –ª–∏–º–∏—Ç–∞ - –≤—Å—è –∑–∞—â–∏—Ç–∞ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
python3 examples/export_group_messages.py "shipyard cohort 1"
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–¥–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ö–∞–∂–¥—ã–µ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–µ–ª–∞–µ—Ç—Å—è –ø–∞—É–∑–∞ 1 —Å–µ–∫—É–Ω–¥–∞
- –ü—Ä–∏ FLOOD_WAIT –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∂–¥–µ—Ç –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç

**–í—Ä–µ–º—è –≤—ã–≥—Ä—É–∑–∫–∏:**
- ~250 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ (—Å —É—á–µ—Ç–æ–º rate limiting –∏ –ø–∞—É–∑)
- –î–ª—è 10K —Å–æ–æ–±—â–µ–Ω–∏–π: ~40 —Å–µ–∫—É–Ω–¥
- –î–ª—è 100K —Å–æ–æ–±—â–µ–Ω–∏–π: ~7 –º–∏–Ω—É—Ç
- –î–ª—è 1M —Å–æ–æ–±—â–µ–Ω–∏–π: ~1 —á–∞—Å

## ‚ö° –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø (–±–∞—Ç—á–∏–Ω–≥)

–ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –æ—á–µ–Ω—å –±–æ–ª—å—à–∞—è (>100K —Å–æ–æ–±—â–µ–Ω–∏–π), –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞—Ç—á–∏–Ω–≥:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–∞—Ç—á–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```bash
# –ü–µ—Ä–≤—ã–π –±–∞—Ç—á: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10000 —Å–æ–æ–±—â–µ–Ω–∏–π
python3 examples/export_group_messages.py "shipyard cohort 1" --limit 10000 -o data/export/batch1.json

# –í—Ç–æ—Ä–æ–π –±–∞—Ç—á: —Å–ª–µ–¥—É—é—â–∏–µ 10000 (–∏—Å–ø–æ–ª—å–∑—É–µ–º min_id –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –±–∞—Ç—á–∞)
# –°–º–æ—Ç—Ä–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π ID –∏–∑ batch1.json –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ min_id
python3 examples/export_group_messages.py "shipyard cohort 1" --limit 10000 --min-id <–ø–æ—Å–ª–µ–¥–Ω–∏–π_id_–∏–∑_batch1> -o data/export/batch2.json

# –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∞—Ç—á–∏–Ω–≥ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç –±–∞—Ç—á–∏:

```python
# –ü—Ä–∏–º–µ—Ä (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ export_group_messages.py)
async def export_in_batches(group_id, batch_size=10000):
    all_messages = []
    min_id = 0
    
    while True:
        batch = await manager.get_messages(group_id, limit=batch_size, min_id=min_id)
        if not batch:
            break
        
        all_messages.extend(batch)
        min_id = batch[-1]['id']
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        save_batch(all_messages, f"batch_{len(all_messages)}.json")
        
        # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
        await asyncio.sleep(5)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞

–í–æ –≤—Ä–µ–º—è –≤—ã–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–≥—Ä—É–∑–∫–∏ (msg/sec)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–Ω—Ç–∏—Å–ø–∞–º —Å–∏—Å—Ç–µ–º—ã

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üì• –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–≥—Ä—É–∑–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π...
   –õ–∏–º–∏—Ç: –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 1000 —Å–æ–æ–±—â–µ–Ω–∏–π (245.3 msg/sec)
   üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 2000 —Å–æ–æ–±—â–µ–Ω–∏–π (248.1 msg/sec)
   ...
‚úÖ –í—ã–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
   –°–æ–æ–±—â–µ–Ω–∏–π –≤—ã–≥—Ä—É–∂–µ–Ω–æ: 12345
   –í—Ä–µ–º—è: 49.8 —Å–µ–∫—É–Ω–¥
   –°–∫–æ—Ä–æ—Å—Ç—å: 247.9 msg/sec

üõ°Ô∏è  –ê–Ω—Ç–∏—Å–ø–∞–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   API –≤—ã–∑–æ–≤–æ–≤: 156
   FLOOD_WAIT —Å–æ–±—ã—Ç–∏–π: 0
```

## ‚ö†Ô∏è –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ FLOOD_WAIT

–ï—Å–ª–∏ Telegram –≤–µ—Ä–Ω–µ—Ç FLOOD_WAIT:
1. **–ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç** - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–æ–∂–¥–µ—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç
2. –°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç —Å–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å
3. –ü–æ—Å–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü—Ä–∏–º–µ—Ä:**
```
[SAFE] FLOOD_WAIT 5s + backoff 1.0s, retry 1/3
‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ 6 —Å–µ–∫—É–Ω–¥...
‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–≥—Ä—É–∑–∫—É...
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –≥—Ä—É–ø–ø –¥–æ 50K —Å–æ–æ–±—â–µ–Ω–∏–π:
```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ –±–µ–∑ –ª–∏–º–∏—Ç–∞
python3 examples/export_group_messages.py "shipyard cohort 1"
```

### –î–ª—è –≥—Ä—É–ø–ø 50K-500K —Å–æ–æ–±—â–µ–Ω–∏–π:
```bash
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞—Ç—á–∏ –ø–æ 50K
python3 examples/export_group_messages.py "shipyard cohort 1" --limit 50000 -o batch1.json
# –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å min_id –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
```

### –î–ª—è –≥—Ä—É–ø–ø >500K —Å–æ–æ–±—â–µ–Ω–∏–π:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞—Ç—á–∏ –ø–æ 50K-100K
- –î–µ–ª–∞–π—Ç–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ (5-10 —Å–µ–∫—É–Ω–¥)
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–¥ –≤—ã–≥—Ä—É–∑–∫–æ–π –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–µ** (—á–µ—Ä–µ–∑ `get_group_info`)
2. **–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ / 250 msg/sec
3. **–°—Ç–∞—Ç—É—Å –∞–Ω—Ç–∏—Å–ø–∞–º —Å–∏—Å—Ç–µ–º—ã**: `get_rate_limiter().get_stats()`

## üí° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤—ã–≥—Ä—É–∑–∫–∞ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–∞—è, –º–æ–∂–Ω–æ:
1. –£–≤–µ–ª–∏—á–∏—Ç—å `RATE_RPS` –≤ `.env` (–Ω–æ –Ω–µ –±–æ–ª—å—à–µ 5-6)
2. –£–º–µ–Ω—å—à–∏—Ç—å –ø–∞—É–∑—ã –≤ `smart_pause` (–Ω–æ —Ä–∏—Å–∫ FLOOD_WAIT)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Å—Å–∏–π (–Ω–æ —Å–ª–æ–∂–Ω–µ–µ)

**–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –æ–±—Ö–æ–¥–∏—Ç—å –∑–∞—â–∏—Ç—É - —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∞–∫–∫–∞—É–Ω—Ç–∞.

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞

–î–ª—è –≥—Ä—É–ø–ø—ã "shipyard cohort 1" –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏:

```bash
python3 examples/export_group_messages.py "shipyard cohort 1"
```

–í—Å—è –∑–∞—â–∏—Ç–∞ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –°–∫—Ä–∏–ø—Ç —Å–∞–º:
- –ó–∞–º–µ–¥–ª–∏—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü–æ–¥–æ–∂–¥–µ—Ç –ø—Ä–∏ FLOOD_WAIT
- –ü–æ–∫–∞–∂–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
- –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

