<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Levin's Bioelectric Worm Sim</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .controls { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; max-width: 600px; }
        canvas { background: #1a1a1a; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; transition: 0.2s; }
        button:hover { background: #0056b3; }
        button.cut { background: #dc3545; }
        button.cut:hover { background: #a71d2a; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="range"] { width: 100%; }
        .status { margin-top: 10px; padding: 10px; background: #e9ecef; border-radius: 6px; font-size: 14px; }
    </style>
</head>
<body>

    <h2>–ú–æ–¥–µ–ª—å –ë–∏–æ—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–π –ü–∞–º—è—Ç–∏ (–ú–∞–π–∫–ª –õ–µ–≤–∏–Ω)</h2>

    <div class="controls">
        <p>–≠—Ç–∞ –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∫–ª–µ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç "–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–π –°–≤–µ—Ç–æ–≤–æ–π –ö–æ–Ω—É—Å" –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—ã.</p>
        
        <button class="cut" onclick="cutWorm()">‚úÇÔ∏è –†–∞–∑—Ä–µ–∑–∞—Ç—å —á–µ—Ä–≤—è</button>
        <button onclick="resetWorm()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å (–ù–æ–≤—ã–π —á–µ—Ä–≤—å)</button>
        
        <label>–°–≤—è–∑—å –º–µ–∂–¥—É –∫–ª–µ—Ç–∫–∞–º–∏ (Gap Junctions): <span id="connVal">100%</span></label>
        <input type="range" id="connection" min="0" max="100" value="100" oninput="updateParams()">
        <small>–í—ã—Å–æ–∫–∞—è —Å–≤—è–∑—å = –∫–ª–µ—Ç–∫–∏ –∑–Ω–∞—é—Ç –æ–±—â–∏–π –ø–ª–∞–Ω —Ç–µ–ª–∞ (–ü–ª–∞—Ç–æ–Ω–æ–≤–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ).<br>–ù–∏–∑–∫–∞—è —Å–≤—è–∑—å = –∫–ª–µ—Ç–∫–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–æ—Å–µ–¥–µ–π (—Ö–∞–æ—Å).</small>

        <div class="status" id="statusText">–°–æ—Å—Ç–æ—è–Ω–∏–µ: –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å. –¶–µ–ª–µ–≤–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞.</div>
    </div>

    <canvas id="simCanvas" width="600" height="300"></canvas>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('statusText');
        
        let cells = [];
        let time = 0;
        let gapJunctionQuality = 1.0; // 0.0 to 1.0
        let isCut = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–≤—è (–Ω–∞–±–æ—Ä –∫–ª–µ—Ç–æ–∫)
        function initWorm() {
            cells = [];
            isCut = false;
            for(let i = 0; i < 40; i++) {
                cells.push({
                    x: 100 + i * 10, // –ü–æ–∑–∏—Ü–∏—è
                    y: 150,
                    targetX: 100 + i * 10, // –¶–µ–ª—å –≤ "–ü–ª–∞—Ç–æ–Ω–æ–≤–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ"
                    targetY: 150,
                    type: i < 5 ? 'head' : (i > 35 ? 'tail' : 'body'), // –¢–∏–ø —Ç–∫–∞–Ω–∏
                    color: i < 5 ? '#ffcc00' : (i > 35 ? '#00ccff' : '#44ff44')
                });
            }
            updateStatus("–ß–µ—Ä–≤—å –∑–¥–æ—Ä–æ–≤. –ë–∏–æ—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è —Å–µ—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–∞.");
        }

        function cutWorm() {
            if(isCut) return;
            isCut = true;
            // –†–∞–∑–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–µ—Ç–∫–∏ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã, –∏–º–∏—Ç–∏—Ä—É—è —Ç—Ä–∞–≤–º—É –∏ –ø–æ—Ç–µ—Ä—é —Å–∏–≥–Ω–∞–ª–∞
            for(let i = 20; i < 40; i++) {
                cells[i].x += (Math.random() - 0.5) * 100;
                cells[i].y += (Math.random() - 0.5) * 100;
            }
            updateStatus("–¢–†–ê–í–ú–ê! –ù–∞—Ä—É—à–µ–Ω–∏–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏. –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ —Ü–µ–ª–∏...");
        }

        function updateParams() {
            const val = document.getElementById('connection').value;
            gapJunctionQuality = val / 100;
            document.getElementById('connVal').innerText = val + "%";
        }

        function updateStatus(text) {
            statusText.innerText = "–°–æ—Å—Ç–æ—è–Ω–∏–µ: " + text;
        }

        function resetWorm() {
            initWorm();
        }

        // –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–∏
        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ "–¶–µ–ª–µ–≤–æ–π —Ñ–æ—Ä–º—ã" (–ø—Ä–∏–∑—Ä–∞–∫ –≤ –ü–ª–∞—Ç–æ–Ω–æ–≤–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ)
            ctx.strokeStyle = '#333';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.rect(95, 130, 410, 40);
            ctx.stroke();
            ctx.setLineDash([]);

            // –õ–æ–≥–∏–∫–∞ –∫–ª–µ—Ç–æ–∫
            cells.forEach((cell, index) => {
                // –ï—Å–ª–∏ —Å–≤—è–∑—å —Ö–æ—Ä–æ—à–∞—è, –∫–ª–µ—Ç–∫–∞ "–≤–∏–¥–∏—Ç" —Å–≤–æ—é –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ü–µ–ª—å
                // –ï—Å–ª–∏ —Å–≤—è–∑—å –ø–ª–æ—Ö–∞—è (–±–ª–æ–∫–∞—Ç–æ—Ä—ã), –∫–ª–µ—Ç–∫–∞ —Ç–µ—Ä—è–µ—Ç—Å—è –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é (–æ—à–∏–±–æ—á–Ω—É—é) –≥–æ–ª–æ–≤—É
                
                let speed = 2.0; // –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                
                if (isCut && index >= 20) {
                    // –õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    if (gapJunctionQuality > 0.5) {
                        // –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è: –∏–¥–µ–º –∫ –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–π —Ü–µ–ª–∏
                        let dx = cell.targetX - cell.x;
                        let dy = cell.targetY - cell.y;
                        cell.x += dx * 0.05 * speed;
                        cell.y += dy * 0.05 * speed;
                    } else {
                        // –û–®–ò–ë–ö–ê –†–ï–ì–ï–ù–ï–†–ê–¶–ò–ò (–¢–µ–æ—Ä–∏—è –õ–µ–≤–∏–Ω–∞)
                        // –ï—Å–ª–∏ —Å–≤—è–∑–∏ –Ω–µ—Ç, –≥—Ä—É–ø–ø–∞ –∫–ª–µ—Ç–æ–∫ –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å, —á—Ç–æ –æ–Ω–∏ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º
                        // –∏ –Ω–∞—á–∞—Ç—å —Å—Ç—Ä–æ–∏—Ç—å –≤—Ç–æ—Ä—É—é –≥–æ–ª–æ–≤—É –≤–º–µ—Å—Ç–æ —Ö–≤–æ—Å—Ç–∞
                        let confusionX = cell.targetX + (Math.sin(time * 0.1) * 20); // –î—Ä–æ–∂–∞–Ω–∏–µ
                        // –ü—Ä–∏ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–π —Å–≤—è–∑–∏ –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Å–±–∏–≤–∞—é—Ç—Å—è –≤ –∫—É—á—É
                        let localTargetX = 300 + (index - 20) * 10; 
                        let localTargetY = 200; // –°–º–µ—â–µ–Ω–∏–µ –æ—Å–∏
                        
                        let dx = localTargetX - cell.x;
                        let dy = localTargetY - cell.y;
                        cell.x += dx * 0.02;
                        cell.y += dy * 0.02;
                        
                        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ "—Å—É–¥—å–±—ã" –∫–ª–µ—Ç–∫–∏
                        if(index > 35) cell.color = '#ffcc00'; // –•–≤–æ—Å—Ç –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –≥–æ–ª–æ–≤—É!
                    }
                }

                // –†–∏—Å—É–µ–º –∫–ª–µ—Ç–∫—É
                ctx.fillStyle = cell.color;
                ctx.beginPath();
                ctx.arc(cell.x, cell.y, 6, 0, Math.PI * 2);
                ctx.fill();
            });

            if(isCut && gapJunctionQuality < 0.3) {
                ctx.fillStyle = "white";
                ctx.font = "16px Arial";
                ctx.fillText("‚ö†Ô∏è –û–®–ò–ë–ö–ê: –ü–æ—Ç–µ—Ä—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ä—Ç–µ —Ç–µ–ª–∞. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ 2-–π –≥–æ–ª–æ–≤—ã.", 50, 280);
            }

            time++;
            requestAnimationFrame(loop);
        }

        initWorm();
        loop();
    </script>
</body>
</html>

